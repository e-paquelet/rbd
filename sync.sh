#!/bin/bash

read -p "Ce script installera automatiquement un script de synchronisation entre Zimbra et l'Active Directory [Y/N] " APP

if [ "$APP" = "Y" ]; then
    (
        echo "================================================================================================================"
        echo "========================================= [   Notice d'utilisation    ] ========================================="
        echo "Ce script va installer un script de synchronisation entre l'Active Directory et Zimbra pour Ubuntu 22."
        echo "Afin que le script fonctionne correctement, assurez-vous que la version de Zimbra que vous utilisez soit :"
        echo "  - Zimbra FOSS v 10.1.4 (lien : https://maldua.github.io/zimbra-foss-builder/downloads.html)"
        echo "  - Ce script doit Ãªtre exÃ©cutÃ© IMPÃ‰RATIVEMENT en tant qu'utilisateur root"
        echo "  - Zimbra doit Ãªtre installÃ©e"
        echo "  - L'authentification par Active Directory Externe doit Ãªtre configurÃ©e sur Zimbra."
        echo "  - Les comptes d'administration de Zimbra doivent Ãªtre crÃ©Ã©s dans l'Active Directory."
        echo "  - Ces comptes doivent Ãªtre dans une UO distincte de celles que vous souhaitez synchroniser."
        echo ""
        echo "Exemple d'arborescence de l'Active Directory :"
        echo "ğŸ“ mondomaine.local"
        echo "â”‚"
        echo "â”œâ”€â”€ ğŸ“ Builtin"
        echo "â”œâ”€â”€ ğŸ“ Computers"
        echo "â”œâ”€â”€ ğŸ“ Domain Controllers"
        echo "â”‚   â”œâ”€â”€ ğŸ“„ Policies"
        echo "â”‚   â””â”€â”€ ğŸ“ <Nom_du_DC>"
        echo "â”œâ”€â”€ ğŸ“ ForeignSecurityPrincipals"
        echo "â”œâ”€â”€ ğŸ“ Managed Service Accounts"
        echo "â”œâ”€â”€ ğŸ“ Program Data"
        echo "â”œâ”€â”€ ğŸ“ System"
        echo "â”‚   â”œâ”€â”€ ğŸ“ Policies"
        echo "â”‚   â”œâ”€â”€ ğŸ“ Scripts"
        echo "â”‚   â””â”€â”€ ğŸ“ DFS-Configuration"
        echo "â”œâ”€â”€ ğŸ“ Users"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¤ Administrateur"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¤ InvitÃ©"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ Utilisateurs du domaine"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ Administrateurs du domaine"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ OpÃ©rateurs de comptes"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ OpÃ©rateurs de sauvegarde"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ OpÃ©rateurs serveur"
        echo "â”‚   â”œâ”€â”€ ğŸ‘¥ OpÃ©rateurs d'impression"
        echo "â”‚   â””â”€â”€ ..."
        echo "â””â”€â”€ ğŸ“ Utilisateurs"
        echo "    â”œâ”€â”€ ğŸ“ direction"
        echo "    â”œâ”€â”€ ğŸ“ service_info"
        echo "    â”‚   â”œâ”€â”€ ğŸ‘¤ Jean"
        echo "    â”œâ”€â”€ ğŸ‘¤ Pierre"
        echo ""
        echo "Tous les utilisateurs dans l'UO Utilisateurs et ses sous-UO seront pris en compte."
        echo "Cependant, les autres utilisateurs (ex: InvitÃ©s) ne seront pas pris en compte."
        echo "Il est conseillÃ© de mettre les comptes administrateurs dans l'UO 'Users' et non 'Utilisateurs'."
        echo ""
        echo "Configuration requise dans Zimbra :"
        echo "  - Configurer l'authentification avec l'Active Directory"
        echo "  - Associer chaque compte Zimbra admin Ã  son compte AD via l'option 'Authentification Externe'"
        echo "  - Cette option se trouve dans l'onglet 'Compte' des propriÃ©tÃ©s des utilisateurs dans l'AD."
        echo ""
        echo "Si vous avez des questions, contactez-moi : etienne.paquelet@gmail.com"
        echo ""
        echo "Variables Ã  modifier pour l'adapter Ã  votre environnement :"
        echo "  - DOMAIN_NAME=\"votredomaine.local\""
        echo "  - domain_name=\"votredomaine.local\""
        echo "  - ADServer=\"IP_Serveur_AD\""
        echo "  - ADUser=\"utilisateur_lien\" (doit Ãªtre dans UO Users)"
        echo "  - ADUserpass=\"motdepasse\""
        echo ""
        echo "Assurez-vous que le rÃ©pertoire 'zadsync' appartient bien Ã  l'utilisateur Zimbra et qu'il possÃ¨de les droits 755."
        echo "================================================================================================================"
    ) | fmt -w 100 | less


    apt-get update -y;
    apt-get upgrade -y;
else 
    echo "Annulation de l'installation."
fi
